#Talked to the creator of sparcraft and he said expect major changes
#Reverting this as it will just get replaced by David's when he pushes the changes.

BWAPI		=	/home/faust/Documents/starcraft-ai/bwapi/bwapi
CAFFE		=	/home/faust/Documents/caffe

#
USE_CUDNN	=	1


BUILD		:=	build
SOURCES		:=	source source/main source/gui
INCLUDES	:=	include

#Target name
TARGET		:=	$(notdir $(CURDIR))
#---------------------------------------------------------------------------------
# automatically build a list of object files for our project
#---------------------------------------------------------------------------------
CPPFILES	:=  	$(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.cpp)))
BWAPIFILES	:= 	$(wildcard $(BWAPI)/BWAPILIB/Source/*.cpp) \
			$(wildcard $(BWAPI)/BWAPILIB/*.cpp)
# Object files
export OFILES	:=	$(addprefix $(BUILD)/,$(CPPFILES:.cpp=.o))			

					
CPPFILES	:=   	$(addprefix $(SOURCES)/,$(CPPFILES))


#---------------------------------------------------------------------------------
# use CXX for linking C++ projects, CC for standard C
#---------------------------------------------------------------------------------


# Compiler
export LD	:=	$(CXX)

#---------------------------------------------------------------------------------
# build a list of include paths
#---------------------------------------------------------------------------------
INCLUDE		=	-I$(BWAPI) \
			-I$(BWAPI)/include \
			-I$(BWAPI)/include/BWAPI \
			-I$(CAFFE)/include \
			-I/usr/local/cuda/include

INCLUDES	:=	$(foreach dir,$(INCLUDES), -I$(CURDIR)/$(dir)) \
				-I$(CURDIR)/$(BUILD)

SDL_LDFLAGS=`sdl2-config --libs` 
SDL_CFLAGS=`sdl2-config --cflags` 
CFLAGS=-O3 -std=c++11 $(SDL_CFLAGS)

LDFLAGS=-lGL -lGLU -lSDL2_image -lopencv_core -lopencv_highgui -lopencv_imgproc -lboost_system -lglog -L$(CAFFE)/build/lib -lcaffe $(SDL_LDFLAGS) -lboost_filesystem

ifeq ($(USE_CUDNN), 1)
	LDFLAGS += -lcudnn
endif

INCLUDES=-I$(BWAPI)/include -I$(BWAPI)/include/BWAPI -I$(BWAPI) -I$(CAFFE)/include -I/usr/local/cuda/include

SOURCES=$(wildcard $(BWAPI)/BWAPILIB/Source/*.cpp) $(wildcard $(BWAPI)/BWAPILIB/*.cpp) $(wildcard source/*.cpp) $(wildcard source/main/*.cpp) $(wildcard source/gui/*.cpp)
OBJECTS=$(SOURCES:.cpp=.o)

all:SparCraft 

SparCraft:$(OBJECTS)
	@echo linking ...
	@$(CC) $(OBJECTS) -o bin/$@  $(LDFLAGS)
	@echo Done

.cpp.o:
	@echo building $< ...
	@$(CC) -c $(CFLAGS) $(INCLUDES) $< -o $@ 
.cc.o:
	@echo building $< ...
	@$(CC) -c $(CFLAGS) $(INCLUDES) $< -o $@

